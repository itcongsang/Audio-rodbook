{"version":3,"file":"static/webpack/static\\development\\pages\\index.js.161194134e562790acd7.hot-update.js","sources":["webpack:///./services/book.service.ts"],"sourcesContent":["import { collection, doc, collectionChanges, fromCollectionRef, fromDocRef } from 'rxfire/firestore';\r\nimport { map, switchMap, combineLatest } from 'rxjs/operators';\r\n\r\nimport { db } from './firebase.service';\r\nimport { Book } from 'models/book';\r\nimport { Channel } from 'models/channel';\r\nimport { of, BehaviorSubject } from 'rxjs';\r\n\r\nclass BookAndChannel {\r\n  books: Book;\r\n  nameChannel: string;\r\n  constructor(data: any = {}) {\r\n    this.books = data.books || null;\r\n    this.nameChannel = data.nameChannel || '';\r\n  }\r\n}\r\n\r\nfunction getAllBooks() {\r\n  let res= collection(db.collection('books').limit(12)).pipe(\r\n    map(snapshot =>\r\n      snapshot.map(doc0 => {\r\n        let rs= new Book(doc0.data());;\r\n        let channelId = rs.channelId;\r\n        return new BookAndChannel({ books: doc0.data(), nameChannel: GetChanelName(channelId) });\r\n      })\r\n    )\r\n  );\r\n  return res;\r\n}\r\n\r\nfunction GetChanelName(e){\r\n  var subject: BehaviorSubject<string>= collection(db.collection('channels').where('channelId', '==', e)).pipe(\r\n    map(res => res.map(doc1 => {\r\n      let resChennel = new Channel(doc1.data());\r\n      return resChennel.name;\r\n\r\n    }))\r\n  );\r\n}\r\n\r\n\r\nfunction getAllBooks2() {\r\n  //console.log('function 2')\r\n  return collection(db.collection('books').limit(12)).pipe(\r\n    switchMap(books => {\r\n      const channelIds = books.map(v => v.data()['channelId']);\r\n      console.log('log 1 ' + channelIds[0])\r\n      return combineLatest(of(books), combineLatest(channelIds.map(channelId => {\r\n        console.log('log 2 ' + channelId)\r\n        doc(db.collection('channels').doc(channelId)).pipe(map(v => {\r\n          console.log('log 3 ' + v);\r\n          return v.data()['name'];\r\n        }))\r\n      })))\r\n    }),\r\n\r\n  );\r\n}\r\n\r\nexport { getAllBooks, getAllBooks2 };\r\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AADA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AALA;AAQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAJA;AAMA;AACA;AAEA;AACA;AACA;AAEA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;;;;;A","sourceRoot":""}