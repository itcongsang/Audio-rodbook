{"version":3,"file":"static/webpack/static\\development\\pages\\index.js.af33944d07047de4a66c.hot-update.js","sources":["webpack:///./pages/index/index.tsx","webpack:///./services/book.service.ts"],"sourcesContent":["import { useObservable } from 'rxjs-hooks';\r\nimport React from 'react';\r\nimport Link from \"next/link\";\r\n\r\nimport Layout from 'components/global/layout';\r\nimport { getAllBooks, getAllBooks2 } from 'services/book.service';\r\nimport './styles.scss';\r\n\r\nexport const Home = () => {\r\n    const res = useObservable(() => getAllBooks2(),[]);\r\n    return (\r\n    <Layout title=\"Dashbord\" description=\"This is the home page\">\r\n      <div className=\"container bt-line\">\r\n        <div className=\"row\">\r\n            <h2 className=\"title-oneach\">Đề xuất</h2>\r\n        </div>\r\n        <div className=\"row\">\r\n          {console.log(res)}\r\n            {res.map((t, i) => {\r\n            return (\r\n              <div key={i} className=\"col-md-2 rs-pad mar-bot-25\">\r\n                <Link href=\"#\">\r\n                  <a title=\"\">\r\n                      <div className=\"img-ct\">\r\n                        <img src={t.v.url} className=\"img-responsive\" />\r\n                      </div>\r\n                      <div className=\"main-ct\">\r\n                        <h3><a>{t.books.name}</a></h3>\r\n                        <span>{t.nameChannel}</span>\r\n                        <div>\r\n                          <span className=\"seen-count\">{t.books.rating} lượt xem</span>\r\n                          <span>1 tuần trước</span>\r\n                        </div>\r\n                      </div>\r\n                    </a>\r\n                </Link>\r\n                  \r\n                </div>\r\n            );\r\n          })}\r\n        \r\n        </div>\r\n      </div>\r\n    </Layout>\r\n  )\r\n}\r\n\r\n\r\nexport default Home;\r\n","import { collection, doc, collectionChanges, fromCollectionRef, fromDocRef } from 'rxfire/firestore';\r\nimport { map, switchMap } from 'rxjs/operators';\r\n\r\nimport { db } from './firebase.service';\r\nimport { Book } from 'models/book';\r\nimport { Channel } from 'models/channel';\r\nimport { of, BehaviorSubject, combineLatest } from 'rxjs';\r\n\r\nclass BookAndChannel {\r\n  books: Book;\r\n  nameChannel: string;\r\n  constructor(data: any = {}) {\r\n    this.books = data.books || null;\r\n    this.nameChannel = data.nameChannel || '';\r\n  }\r\n}\r\n\r\nfunction getAllBooks() {\r\n  let res= collection(db.collection('books').limit(12)).pipe(\r\n    map(snapshot =>\r\n      snapshot.map(doc0 => {\r\n        let rs= new Book(doc0.data());;\r\n        let channelId = rs.channelId;\r\n        return new BookAndChannel({ books: doc0.data(), nameChannel: GetChanelName(channelId) });\r\n      })\r\n    )\r\n  );\r\n  return res;\r\n}\r\n\r\nfunction GetChanelName(e){\r\n  var subject = new BehaviorSubject<string>(\"\");\r\n  collection(db.collection('channels').where('channelId', '==', e)).pipe(\r\n    map(res => res.map(doc1 => {\r\n      let resChennel = new Channel(doc1.data());\r\n      subject.next(resChennel.name);\r\n    }))\r\n  );\r\n  return subject.value;\r\n}\r\n\r\n\r\nfunction getAllBooks2() {\r\n  console.log('function 2')\r\n  return collection(db.collection('books').limit(12)).pipe(\r\n    switchMap(books => {\r\n      const channelIds = books.map(v => v.data()['channelId']);\r\n      console.log('log 1 ' + channelIds[0]);\r\n      const books2 = books.map(v => v.data());\r\n      return combineLatest(of(books2), combineLatest(channelIds.map(channelId => {\r\n        console.log('log 2 ' + channelId)\r\n        collection(db.collection('channels').where('channelId', '==', channelIds)).pipe(map(v => {\r\n          console.log('log 3 ' + v);\r\n          return v[0].data();\r\n        }))\r\n      })))\r\n    }),\r\n    map(([books, channels]) => {\r\n      return books.map(book => {\r\n        return {book, channels}\r\n      })\r\n      //return {books, channels};\r\n    })\r\n  );\r\n}\r\n\r\nexport { getAllBooks, getAllBooks2 };\r\n"],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AAEA;AAAA;AAGA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AAEA;AAAA;AAIA;AAAA;AASA;AAMA;AAGA;;;;;;;;;;;;;;;;;;;;;;;;;AChDA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AADA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AALA;AAQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAHA;AAKA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAEA;AAEA;AACA;;;;;A","sourceRoot":""}