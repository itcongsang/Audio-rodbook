{"version":3,"file":"static/webpack/static\\development\\pages\\index.js.fa5b7f68bf1b1fc5a87d.hot-update.js","sources":["webpack:///./services/book.service.ts"],"sourcesContent":["import { collection, doc, collectionChanges, fromCollectionRef, fromDocRef } from 'rxfire/firestore';\r\nimport { map, switchMap } from 'rxjs/operators';\r\n\r\nimport { db } from './firebase.service';\r\nimport { Book } from 'models/book';\r\nimport { Channel } from 'models/channel';\r\nimport { of, BehaviorSubject, combineLatest, from } from 'rxjs';\r\n\r\n// class BookAndChannel {\r\n//   books: Book;\r\n//   nameChannel: string;\r\n//   constructor(data: any = {}) {\r\n//     this.books = data.books || null;\r\n//     this.nameChannel = data.nameChannel || '';\r\n//   }\r\n// }\r\n\r\nfunction getAllBooks() {\r\n  let res= from (collection(db.collection('books').limit(12)).pipe(\r\n    map(snapshot =>\r\n      snapshot.map(doc0 => {\r\n        let rs= new Book(doc0.data());\r\n        return rs;\r\n        // let channelId = rs.channelId;\r\n        // return collection(db.collection('channels').where('channelId', '==', channelId)).pipe(\r\n        //   map(res => res.map(doc1 => {\r\n        //     let resChennel = new Channel(doc1.data()).name;\r\n        //     return new BookAndChannel({ books: doc0.data(), nameChannel: resChennel });\r\n        //   }))\r\n        // );\r\n      })\r\n    )\r\n  ));\r\n  res.pipe().subscribe(val=>{console.log(val)})\r\n  return res;\r\n}\r\n\r\nfunction GetChanelName(e){\r\n  var subject = new BehaviorSubject<string>(\"\");\r\n  collection(db.collection('channels').where('channelId', '==', e)).pipe(\r\n    map(res => res.map(doc1 => {\r\n      let resChennel = new Channel(doc1.data());\r\n      subject.next(resChennel.name);\r\n    }))\r\n  );\r\n  return subject.value;\r\n}\r\n\r\n\r\nfunction getAllBooks2() {\r\n  console.log('function 2')\r\n  return collection(db.collection('books').limit(12)).pipe(\r\n    switchMap(books => {\r\n      const channelIds = books.map(v => v.data()['channelId']);\r\n      console.log('log 1 ' + channelIds[0]);\r\n      const books2 = books.map(v => v.data());\r\n      return combineLatest(of(books2), combineLatest(channelIds.map(channelId => {\r\n        console.log('log 2 ' + channelId)\r\n        collection(db.collection('channels').where('channelId', '==', channelIds)).pipe(map(v => {\r\n          console.log('log 3 ' + v);\r\n          return v[0].data();\r\n        }))\r\n      })))\r\n    }),\r\n    map(([books, channels]) => {\r\n      return books.map(book => {\r\n        return {book, channels}\r\n      })\r\n      //return {books, channels};\r\n    })\r\n  );\r\n}\r\n\r\nexport { getAllBooks, getAllBooks2 };\r\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AAEA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAXA;AAcA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAHA;AAKA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAEA;AAEA;AACA;;;;;A","sourceRoot":""}