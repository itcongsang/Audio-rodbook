{"ast":null,"code":"import _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport { collection, doc } from 'rxfire/firestore';\nimport { map, switchMap, combineLatest } from 'rxjs/operators';\nimport { db } from \"./firebase.service\";\nimport { Channel } from \"../models/channel\";\nimport { of } from 'rxjs';\n\nvar BookAndChannel = function BookAndChannel() {\n  var data = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n  _classCallCheck(this, BookAndChannel);\n\n  this.books = data.books || null;\n  this.nameChannel = data.nameChannel || '';\n};\n\nfunction getAllBooks() {\n  return collection(db.collection('books').limit(12)).pipe(map(function (snapshot) {\n    return snapshot.map(function (doc0) {\n      console.log(doc0.data());\n      var books = doc0.data();\n      var channelId = books.channelId;\n      var acun = collection(db.collection('channels').where('channelId', '==', channelId)).pipe(map(function (res) {\n        return res.map(function (doc1) {\n          console.log(doc1);\n          var resChennel = new Channel(doc1.data());\n          var nameCN = resChennel.name;\n          var rs = new BookAndChannel({\n            books: books,\n            nameCN: nameCN\n          });\n          return rs;\n        });\n      }));\n      acun.subscribe(function (t) {\n        console.log(t);\n      });\n      return acun;\n    });\n  }));\n}\n\nfunction getAllBooks2() {\n  //console.log('function 2')\n  return collection(db.collection('books').limit(12)).pipe(switchMap(function (books) {\n    var channelIds = books.map(function (v) {\n      return v.data()['channelId'];\n    });\n    console.log('log 1 ' + channelIds[0]);\n    return combineLatest(of(books), combineLatest(channelIds.map(function (channelId) {\n      console.log('log 2 ' + channelId);\n      doc(db.collection('channels').doc(channelId)).pipe(map(function (v) {\n        console.log('log 3 ' + v);\n        return v.data()['name'];\n      }));\n    })));\n  }));\n}\n\nexport { getAllBooks, getAllBooks2 };","map":{"version":3,"sources":["D:/SolutionReactJs/SourceDefault/audio-rodbook/services/book.service.ts"],"names":["collection","doc","map","switchMap","combineLatest","db","Channel","of","BookAndChannel","data","books","nameChannel","getAllBooks","limit","pipe","snapshot","doc0","console","log","channelId","acun","where","res","doc1","resChennel","nameCN","name","rs","subscribe","t","getAllBooks2","channelIds","v"],"mappings":"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","sourcesContent":["import { collection, doc, collectionChanges, fromCollectionRef, fromDocRef } from 'rxfire/firestore';\r\nimport { map, switchMap, combineLatest } from 'rxjs/operators';\r\n\r\nimport { db } from './firebase.service';\r\nimport { Book } from 'models/book';\r\nimport { Channel } from 'models/channel';\r\nimport { of } from 'rxjs';\r\n\r\nclass BookAndChannel {\r\n  books: Book;\r\n  nameChannel: string;\r\n  constructor(data: any = {}) {\r\n    this.books = data.books || null;\r\n    this.nameChannel = data.nameChannel || '';\r\n  }\r\n}\r\n\r\nfunction getAllBooks() {\r\n  return collection(db.collection('books').limit(12)).pipe(\r\n    map(snapshot =>\r\n      snapshot.map(doc0 => {\r\n        console.log(doc0.data());\r\n        let books = doc0.data();\r\n        let channelId = books.channelId;\r\n        let acun = collection(db.collection('channels').where('channelId', '==', channelId)).pipe(\r\n          map(res => res.map(doc1 => {\r\n            console.log(doc1);\r\n\r\n            let resChennel = new Channel(doc1.data());\r\n            var nameCN = resChennel.name;\r\n            let rs = new BookAndChannel({ books, nameCN });\r\n            return rs;\r\n          }))\r\n        );\r\n        acun.subscribe(t=>{\r\n          console.log(t);\r\n        })\r\n        return acun;\r\n      })\r\n    )\r\n  );\r\n}\r\n\r\n\r\nfunction getAllBooks2() {\r\n  //console.log('function 2')\r\n  return collection(db.collection('books').limit(12)).pipe(\r\n    switchMap(books => {\r\n      const channelIds = books.map(v => v.data()['channelId']);\r\n      console.log('log 1 ' + channelIds[0])\r\n      return combineLatest(of(books), combineLatest(channelIds.map(channelId => {\r\n        console.log('log 2 ' + channelId)\r\n        doc(db.collection('channels').doc(channelId)).pipe(map(v => {\r\n          console.log('log 3 ' + v);\r\n          return v.data()['name'];\r\n        }))\r\n      })))\r\n    }),\r\n\r\n  );\r\n}\r\n\r\nexport { getAllBooks, getAllBooks2 };\r\n"]},"metadata":{},"sourceType":"module"}